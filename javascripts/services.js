(function(){var e,t,n,r,i,s;i=apiHost,s=window,n=40,r=0,t=function(){var e,t,n,r,i,o,u,a;r={},t=s.location.search.substring(1).split("&");for(o=0,u=t.length;o<u;o++)n=t[o],a=n.split("="),e=a[0],i=a[1],e=decodeURIComponent(e),i=decodeURIComponent(i),i!=null&&i.length>0&&(r[e]=i);return r},e=angular.module("kodeposApp",["infinite-scroll"]),e.factory("placesService",["$http",function(e){var t;return t=function(t,n){return e({url:apiHost+t,method:"GET",params:n})},{getPlaces:function(e){return t("/places.json",e)},getPostalCodes:function(e){return t("/postalCodes.json",e)},getCities:function(e){return t("/cities.json",e)}}}]),e.controller("PlacesCtrl",["$scope","placesService","$timeout",function(e,s,o){var u,a,f;u=$("#place-city"),u.autocomplete({serviceUrl:""+i+"/autocomplete/cities.json",minChars:3,onSelect:function(e,t){return u.trigger("input")}}),a=$("#place-postalCode"),a.autocomplete({serviceUrl:""+i+"/autocomplete/postalCodes.json",minChars:3,onSelect:function(e,t){return a.trigger("input"),$(this.form).submit()}}),e.submitted=!1,e.loading=!1,e.submit=function(){var t;return e.loading=!0,t=e.place||{},t.limit||(t.limit=n),t.offset=r,s.getPlaces(t).then(function(t){var n,r;return e.submitted=!0,n=e.list=t.data.data,r=e.pageParams=t.data.pageParams,e.noResult=r.next==null&&(!n||n.length===0),e.loading=!1})},e.fetchNext=function(){var t;if(e.loading||e.place==null||e.list==null||e.pageParams.next==null)return;return e.loading=!0,t=e.place,t.limit=e.pageParams.next.limit||n,t.offset=e.pageParams.next.offset||r,s.getPlaces(t).then(function(t){var n,r,i,s,o;n=t.data.data,i=e.pageParams=t.data.pageParams;for(s=0,o=n.length;s<o;s++)r=n[s],e.list.push(r);return e.noResult=!1,e.loading=!1})},f=t();if(f.city!=null||f.postalCode!=null||f.street!=null)return e.place=f,e.submit()}]),e.controller("PostalCodesCtrl",["$scope","placesService",function(e,t){var n,i;return i=80,e.loading=!0,n={offset:r,limit:i},t.getPostalCodes(n).then(function(t){return e.list=t.data.data,e.pageParams=t.data.pageParams,e.loading=!1}),e.fetchNext=function(){if(e.loading||e.list==null||e.pageParams.next==null)return;return e.loading=!0,n={},n.limit=e.pageParams.next.limit||i,n.offset=e.pageParams.next.offset||r,t.getPostalCodes(n).then(function(t){var n,r,i,s,o;n=t.data.data,i=e.pageParams=t.data.pageParams;for(s=0,o=n.length;s<o;s++)r=n[s],e.list.push(r);return e.loading=!1})}}]),e.controller("CitiesCtrl",["$scope","placesService",function(e,t){var i;return e.loading=!0,i={offset:r,limit:n},t.getCities(i).then(function(t){return e.list=t.data.data,e.pageParams=t.data.pageParams,e.loading=!1}),e.fetchNext=function(){if(e.loading||e.list==null||e.pageParams.next==null)return;return e.loading=!0,i={},i.limit=e.pageParams.next.limit||n,i.offset=e.pageParams.next.offset||r,t.getCities(i).then(function(t){var n,r,i,s,o;n=t.data.data,i=e.pageParams=t.data.pageParams;for(s=0,o=n.length;s<o;s++)r=n[s],e.list.push(r);return e.loading=!1})}}]),e.controller("ShareCtrl",["$scope",function(e){return e.shareOnTwitter=function(){var e,t,n;return n="https://twitter.com/intent/tweet?",e=s.location.href,t={hashtags:"",original_referer:e,text:$("title").text(),tw_p:"tweetbutton",url:e},s.open(n+$.param(t),"sharer","width=626,height=436")},e.shareOnFacebook=function(){var e;return e="https://www.facebook.com/sharer/sharer.php?u=",s.open(e+s.location.href,"sharer","width=626,height=436")}}])}).call(this);